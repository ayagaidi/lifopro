# الحل المقترح في حالة انقطاع الإنترنت أثناء تصدير البيانات من قبل المكاتب والشركات

## 1. تحليل المشكلة
- النظام يعتمد على خدمة LifoApiService لعمليات مثل طباعة البطاقات (printcard) وإصدار السياسات، والتي تتطلب اتصال إنترنت.
- عند انقطاع الإنترنت، تفشل هذه العمليات، مما يمنع المكاتب والشركات من تصدير التقارير أو البطاقات التي تعتمد على API.
- التصدير المحلي (مثل تقارير PDF من قاعدة البيانات المحلية) قد يعمل، لكن التصدير الذي يتطلب API (مثل viewdocument في ReportController) يفشل.

## 2. الحل المقترح
- **فصل الوضعين (Online/Offline Mode):**
  - أضف خيار في النظام للتبديل بين وضع متصل (Online) وغير متصل (Offline).
  - في الوضع غير المتصل، قم بتعطيل العمليات التي تتطلب API واستخدم البيانات المحلية أو المخزنة مؤقتًا.

- **التحسينات المطلوبة:**
  - **تخزين مؤقت (Caching):** خزن البيانات المطلوبة للتصدير (مثل بيانات البطاقات والتقارير) محليًا عند الاتصال بالإنترنت، لاستخدامها في الوضع غير المتصل.
  - **طابور العمليات (Queueing):** للعمليات التي تتطلب API (مثل طباعة البطاقات)، أضفها إلى طابور لتنفيذها لاحقًا عند عودة الاتصال.
  - **إشعارات للمستخدم:** أظهر رسائل تحذير عند محاولة عمليات تتطلب إنترنت في الوضع غير المتصل، واقترح البدائل.
  - **تصدير محلي:** ضمن أن التقارير PDF (مثل exportAllPdf) تعمل محليًا دون الحاجة إلى API.

## 3. خطوات التنفيذ
- أضف عمودًا في قاعدة البيانات لتخزين حالة الاتصال (مثل is_online في جدول settings).
- عدل LifoApiService للتحقق من الاتصال قبل إرسال الطلبات، وإذا فشل، أضف العملية إلى طابور.
- استخدم Laravel Queues لمعالجة العمليات المؤجلة.
- أضف واجهة مستخدم للتبديل بين الأوضاع ومراقبة حالة الاتصال.

## 4. الفوائد
- يضمن استمرارية العمل للمكاتب والشركات أثناء انقطاع الإنترنت.
- يقلل من فقدان البيانات ويحسن تجربة المستخدم.
